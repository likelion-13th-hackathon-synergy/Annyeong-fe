<!DOCTYPE html>
<html lang="ko">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1, viewport-fit=cover" />
  <title>회원가입</title>
  <link rel="stylesheet" href="signup.css" />
  <meta name="csrf-token" content="">
</head>
<body>
  <main class="phone">
    <!-- 상태바 -->
    <header class="statusbar" role="banner">
      <span class="sb-time"></span>
      <div class="sb-icons" aria-hidden="true">
        <img src="../assets/images/cellular.svg" alt="">
        <img src="../assets/images/wifi.svg" alt="">
        <img src="../assets/images/battery.svg" alt="">
      </div>
    </header>

    <!-- 상단 로고 / 역할 -->
    <div class="top">
      <div class="brand">
        <img src="../assets/icons/logo.svg" alt="안녕 로고">
      </div>
      <button class="top-right-icon" type="button" aria-label="언어 설정">
        <img src="../assets/icons/lang.svg" alt="">
      </button>
    </div>

    <!-- 타이틀 -->
    <h1 class="title" data-i18n-key="join">회원가입</h1>

    <p class="subtitle">
      <span data-i18n-key="first_join_q">이미 회원이신가요?</span>
      <a href="login.html" class="link" data-i18n-key="go_login">로그인하러가기</a>
    </p>

    <!-- 폼 -->
    <form class="form" action="#" method="get" novalidate>
      <!-- 이름 / 국적 -->
      <div class="row-2">
        <div class="input-group">
          <label for="name" class="input-label" data-i18n-key="name">이름</label>
          <div class="field">
            <span class="icon" aria-hidden="true">
              <svg width="20" height="20" viewBox="0 0 24 24" fill="none">
                <circle cx="12" cy="8" r="4" stroke="currentColor" stroke-width="1.6"/>
                <path d="M4 20c0-4 4-6 8-6s8 2 8 6" stroke="currentColor" stroke-width="1.6" stroke-linecap="round"/>
              </svg>
            </span>
            <input id="name" type="text" data-i18n-key="real_name" placeholder="실명" required />
          </div>
        </div>

        <div class="input-group">
          <label for="nation" class="input-label" data-i18n-key="local">내국인</label>
          <div class="field select-field">
            <select id="nation" aria-label="국적 선택">
              <option value="kr" data-i18n-key="local" selected>내국인</option>
              <option value="foreigner" data-i18n-key="foreigner">외국인</option>
            </select>
            <span class="caret" aria-hidden="true">
              <svg width="20" height="20" viewBox="0 0 24 24" fill="none">
                <path d="M7 10l5 5 5-5" stroke="currentColor" stroke-width="1.6" stroke-linecap="round" stroke-linejoin="round"/>
              </svg>
            </span>
          </div>
        </div>
      </div>

      <!-- 이메일 -->
      <div class="input-group">
        <label for="email" class="input-label" data-i18n-key="your_email">이메일</label>
        <div class="field">
          <span class="icon" aria-hidden="true">
            <svg width="20" height="20" viewBox="0 0 24 24" fill="none">
              <path d="M4 6h16a1 1 0 0 1 1 1v10a1 1 0 0 1-1 1H4a1 1 0 0 1-1-1V7a1 1 0 0 1 1-1zm0 0 8 6 8-6"
                stroke="currentColor" stroke-width="1.6" stroke-linecap="round" stroke-linejoin="round"/>
            </svg>
          </span>
          <input id="email" type="email" placeholder="example@gmail.com" required />
        </div>
      </div>

      <!-- 비밀번호 -->
      <div class="input-group">
        <label for="pw" class="input-label" data-i18n-key="your_password">비밀번호</label>
        <div class="field">
          <span class="icon" aria-hidden="true">
            <svg width="20" height="20" viewBox="0 0 24 24" fill="none">
              <rect x="4" y="11" width="16" height="9" rx="2" stroke="currentColor" stroke-width="1.6"/>
              <path d="M8 11V8a4 4 0 1 1 8 0v3" stroke="currentColor" stroke-width="1.6" stroke-linecap="round"/>
            </svg>
          </span>
          <!-- 특수문자 1개 이상 + 6자 이상 -->
          <input id="pw" type="password" data-i18n-key="six"
                 placeholder="특수문자 포함 6자리"
                 autocomplete="new-password"
                 required />
        </div>
        <p class="form-hint ok" id="pw-hint-ok" data-i18n-key="password_ok">😊 사용할 수 있는 비밀번호 입니다.</p>
      </div>

      <!-- 비밀번호 확인 -->
      <div class="input-group">
        <label for="pw2" class="input-label" data-i18n-key="password_check">비밀번호 확인</label>
        <div class="field">
          <span class="icon" aria-hidden="true">
            <svg width="20" height="20" viewBox="0 0 24 24" fill="none">
              <rect x="4" y="11" width="16" height="9" rx="2" stroke="currentColor" stroke-width="1.6"/>
              <path d="M8 11V8a4 4 0 1 1 8 0v3" stroke="currentColor" stroke-width="1.6" stroke-linecap="round"/>
            </svg>
          </span>
          <input id="pw2" type="password" data-i18n-key="password_again"
                 placeholder="비밀번호를 다시 입력해주세요"
                 autocomplete="new-password"
                 required />
        </div>
        <p class="form-hint err" id="pw2-hint-err" data-i18n-key="password_no">🙅‍♀️ 비밀번호가 틀립니다.</p>
      </div>

      <!-- 회원가입 -->
      <button
        id="submitBtn"
        type="submit"
        class="btn-primary"
        formaction="../profile/profile.html"
        formmethod="get"
        data-i18n-key="join_button"
        disabled
      >회원가입</button>

     
    </form>
  </main>

  <!-- ✅ 실시간 유효성 검사 스크립트 -->
  <script type="module">

    
    const nameInput = document.getElementById('name');
    const emailInput = document.getElementById('email');
    const pwInput = document.getElementById('pw');
    const pw2Input = document.getElementById('pw2');
    const submitBtn = document.getElementById('submitBtn');

    const pwOkHint = document.getElementById('pw-hint-ok');
    const pw2ErrHint = document.getElementById('pw2-hint-err');

    const pwRule = /^(?=.*[~`!@#$%^&*()_\-+={}\[\]|\\:;"'<>,.?/]).{6,}$/;

    function mark(el, state) {
      const field = el.closest('.field');
      field.classList.remove('valid', 'invalid');
      if (state === 'valid') field.classList.add('valid');
      if (state === 'invalid') field.classList.add('invalid');
    }

    function validate() {
      const nameOk  = nameInput.value.trim().length > 0;
      const emailOk = emailInput.value.trim().length > 0 && emailInput.checkValidity();
      const pwOk    = pwRule.test(pwInput.value || '');
      const pw2Ok   = pwInput.value.length > 0 && pw2Input.value === pwInput.value;

      // 테두리 색
      mark(nameInput,  nameInput.value ? (nameOk ? 'valid' : 'invalid') : null);
      mark(emailInput, emailInput.value ? (emailOk ? 'valid' : 'invalid') : null);
      mark(pwInput,    pwInput.value ? (pwOk ? 'valid' : 'invalid') : null);
      mark(pw2Input,   pw2Input.value ? (pw2Ok ? 'valid' : 'invalid') : null);

      // 힌트 표시
      pwOkHint.style.display  = pwOk && pwInput.value ? 'block' : 'none';
      pw2ErrHint.style.display = (!pw2Ok && pw2Input.value) ? 'block' : 'none';

      // 버튼 활성화
      const allOk = nameOk && emailOk && pwOk && pw2Ok;
      submitBtn.disabled = !allOk;
    }

    // 이벤트
    [nameInput, emailInput, pwInput, pw2Input].forEach(el => {
      el.addEventListener('input', validate);
      el.addEventListener('blur', validate);
    });

    // 초기 상태
    validate();

    import { startStatusbarClock } from '../assets/js/statusbar-time.js';
startStatusbarClock({ hour12: false, locale: "ko-KR" });
  </script>
  <script type="module" src="./signup.api.js"></script>
  <script type="module">
    import { initI18n, toggleLang, getLang } from "../assets/js/i18n.js";
  
    // 페이지 진입 시 저장된 언어 적용
    await initI18n();
  
    // 우상단 아이콘 클릭 → ko/en 토글
    const langBtn = document.querySelector(".top-right-icon");
    langBtn?.addEventListener("click", async () => {
      const cur = await toggleLang(); // ko ↔ en
      langBtn.setAttribute(
        "aria-label",
        cur === "ko" ? "언어 설정: 한국어" : "Language: English"
      );
    });
  </script>
  
</body>
</html>
