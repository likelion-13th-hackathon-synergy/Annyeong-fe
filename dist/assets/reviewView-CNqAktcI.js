import"./modulepreload-polyfill-B5Qt9EMX.js";import{a as d,A as h}from"./auth-CgfX5zSn.js";import{s as m,g as p,i as f}from"./i18n-DcpoQoQT.js";const l=new URLSearchParams(location.search),i=Number(l.get("user_id"));l.get("roomId");const _=decodeURIComponent(l.get("name")||"");async function g(){const t=await fetch("/users/profile/",{method:"GET",credentials:"include",headers:{Accept:"application/json"}});if(!t.ok)throw new Error(String(t.status));return t.json()}async function w(){try{const e=await g();return window.__ME__=e,!0}catch{const e=location.pathname+location.search;return location.replace(`/Annyeong-fe/login/login.html?next=${encodeURIComponent(e)}`),!1}}const y={personalities_1:"good_listener",personalities_2:"good_humor",personalities_3:"fun_talk",personalities_4:"positive_mindset",personalities_5:"friendly_warm",personalities_6:"thoughtful_caring",personalities_7:"knowledgeable",personalities_8:"curious",personalities_9:"understanding",personalities_10:"honest_sincere",personalities_11:"active_energetic",personalities_12:"trustworthy"};function E(e){const t=document.querySelector(".review-w-title #strong-text")||document.querySelector(".review-w-title .strong-text-name");t&&(t.textContent=`‘ ${e} ’`)}function C({total_reviews:e=0,total_personality_selections:t=0}){const o=document.querySelector(".selected-num .times"),n=document.querySelector(".selected-num .gray-text");o&&(o.textContent=`✔ ${Number(t)}회`),n&&(n.textContent=` ${Number(e)}참여`)}function b(e){return(Array.isArray(e?.reviews)?e.reviews:[]).map(o=>{const n=Object.keys(o).find(a=>a.startsWith("personalities_")),s=n?o[n]:"",r=Number(o.count||0);return{key:n,label:s,count:r}})}function I(e){const t=document.getElementById("reviewList");if(!t)return;if(t.innerHTML="",!e.length){const n=document.createElement("li");n.textContent="표시할 리뷰가 없습니다.",t.appendChild(n);return}const o=Math.max(...e.map(n=>n.count),1);e.forEach(n=>{const s=document.createElement("li"),r=document.createElement("span");r.className="review-label";const a=y[n.key]||null;a?(r.setAttribute("data-i18n-key",a),r.textContent=`"${n.label}"`):r.textContent=`"${n.label}"`;const c=document.createElement("span");c.className="review-count",c.textContent=n.count;const u=n.count/o*85;s.style.setProperty("--w",u+"%"),s.appendChild(document.createTextNode(" ")),s.appendChild(r),s.appendChild(c),t.appendChild(s)}),m(p(),{persist:!1})}async function v(){try{if(!Number.isFinite(i)||i<=0){alert("유효하지 않은 접근입니다. (user_id 누락)"),history.length>1?history.back():location.href="../home/home.html";return}if(!await w())return;const t=await d(`/reviews/user/${i}/`,{method:"GET",headers:{"Content-Type":"application/json"}},h);if(!t.ok){const r=await t.text().catch(()=>"");throw new Error(`데이터 로드 실패: ${t.status} ${r}`)}const o=await t.json(),n=o?.username||_||String(i);E(n),C({total_reviews:o.total_reviews,total_personality_selections:o.total_personality_selections});const s=b(o);I(s)}catch(e){console.error(e),alert("페이지 로드 중 오류가 발생했습니다.")}}document.addEventListener("DOMContentLoaded",()=>{const e=document.querySelector(".back-btn");e&&e.addEventListener("click",()=>{const t=new URL(location.href),o=t.searchParams.get("from"),n=t.searchParams.get("roomId"),s=t.searchParams.get("name")||"",r=sessionStorage.getItem("REVIEW_BACK_URL");if(o==="write"&&r){sessionStorage.removeItem("REVIEW_BACK_URL"),location.href=r;return}if(r){sessionStorage.removeItem("REVIEW_BACK_URL"),location.href=r;return}if(document.referrer&&!/review-write\.html/i.test(document.referrer)){location.href=document.referrer;return}if(n){location.href=`../chat/chat-room.html?roomId=${n}&name=${encodeURIComponent(s)}`;return}location.href="../chat/chat-list.html"})});document.addEventListener("DOMContentLoaded",v);f();window.addEventListener("storage",e=>{e.key==="preferredLang"&&e.newValue&&m(e.newValue,{persist:!1})});
