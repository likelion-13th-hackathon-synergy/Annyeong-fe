import"./modulepreload-polyfill-B5Qt9EMX.js";import{s as C}from"./statusbar-time-3u5cukCV.js";import{i as F,t as O}from"./i18n-DcpoQoQT.js";typeof C=="function"&&C({selector:".sb-time",hour12:!1,locale:"ko-KR"});const P="",U="/login/login.html",q="/home/home.html",i=e=>document.querySelector(e);function w(e){const t=document.cookie.match(new RegExp("(^|; )"+e+"=([^;]*)"));return t?decodeURIComponent(t[2]):null}function A(e){return!["GET","HEAD","OPTIONS","TRACE"].includes(String(e).toUpperCase())}function H(e){const t=document.querySelector('meta[name="csrf-token"]');t&&t.setAttribute("content",e||"")}async function S(){let e=w("csrftoken");return e||(await fetch("/users/csrf/",{credentials:"include"}),e=w("csrftoken")),H(e),e}async function d(e,t={}){const o=(t.method||"GET").toUpperCase(),n=new Headers(t.headers||{});n.has("Accept")||n.set("Accept","application/json");const a=t.body instanceof FormData;if(A(o)){const c=w("csrftoken")||await S();n.set("X-CSRFToken",c),!a&&!n.has("Content-Type")&&n.set("Content-Type","application/json")}const s=await fetch(`${P}${e}`,{...t,method:o,headers:n,credentials:"include"}),l=await s.text();let r=null;try{r=l?JSON.parse(l):null}catch{r={raw:l}}if(!s.ok){const c=typeof r=="string"&&r||r?.detail||JSON.stringify(r)||`HTTP ${s.status}`,f=new Error(c);throw f.status=s.status,f.payload=r,f}return r}async function G(){try{return await d("/users/profile/"),!0}catch{const e=location.pathname+location.search;return location.replace(`${U}?next=${encodeURIComponent(e)}`),!1}}const v=i("#real_name"),y=i("#age"),b=i("#country"),k=i("#sido"),$=i("#lang"),E=i("#trans"),_=i("#bio"),u=document.querySelector(".avatar img[alt='프로필 이미지']"),g=document.querySelector(".badge-img"),N=document.querySelector(".edit-photo"),p=document.querySelector(".verify-banner"),m=document.querySelector(".verify-banner .vb-close");document.querySelector(".verify-banner .vb-badge");const x=i("#previewBtn"),M=i("#submitBtn"),j=i("#googleConnectBtn");let h=null;function I(e){p&&(e===!0?(p.style.display="none",m.style.display="none"):(p.style.display="",m.style.display=""))}async function T(){try{const e=await d("/users/profile/");v&&(v.value=e.real_name??""),y&&(y.value=e.age??""),b&&e.nationality&&(b.value=e.nationality),k&&e.city&&(k.value=e.city),$&&e.service_language&&($.value=e.service_language),E&&e.translation_category&&(E.value=e.translation_category),_&&(_.value=e.introduction??""),u&&e.profile_image&&(u.src=e.profile_image),g&&(g.style.display=e.google_verified?"block":"none"),I(e.google_verified)}catch(e){console.warn("프로필 불러오기 실패:",e)}}function J(e=!0){const t=new FormData;return t.append("real_name",(v?.value||"").trim()),t.append("age",y?.value?String(y.value):""),t.append("nationality",b?.value||""),t.append("city",k?.value||""),t.append("introduction",(_?.value||"").trim()),t.append("service_language",$?.value||""),t.append("translation_category",E?.value||""),e&&h instanceof File&&t.append("profile_image",h),t}async function B(e=!0){const t=J(e);return d("/users/profile/",{method:"PUT",body:t})}function W(){const e=document.createElement("input");return e.type="file",e.accept="image/*",e.style.display="none",document.body.appendChild(e),e}function V(e){return e?/^image\//.test(e.type)?e.size>10*1024*1024?"이미지 크기는 10MB 이하만 가능합니다.":null:"유효한 이미지 파일을 선택해 주세요.":"이미지 파일을 선택해 주세요."}async function z(e){e.preventDefault();const t=W();t.addEventListener("change",async()=>{const o=t.files?.[0];t.remove();const n=V(o);if(n){alert(n);return}h=o,u&&(u.src=URL.createObjectURL(o));try{const a=await B(!0);u&&a?.profile_image&&(u.src=a.profile_image),alert("프로필 이미지가 업데이트되었습니다.")}catch(a){console.error(a),alert(`이미지 업로드 실패: ${a.message||a}`),h=null,await T()}}),t.click()}function K(e,t="google_oauth",o=520,n=700){const a=window.screenLeft??screen.left,s=window.screenTop??screen.top,l=window.innerWidth||document.documentElement.clientWidth||screen.width,r=window.innerHeight||document.documentElement.clientHeight||screen.height,c=l/window.screen.availWidth,f=(l-o)/2/c+a,R=(r-n)/2/c+s,D=`noopener,noreferrer,scrollbars=yes,width=${o/c},height=${n/c},top=${R},left=${f}`;return window.open(e,t,D)}async function X({intervalMs:e=1200,timeoutMs:t=12e4}={}){const o=Date.now();for(;;){if(Date.now()-o>t)throw new Error("구글 인증 시간이 초과되었습니다.");try{const n=await d("/users/profile/preview/");if(n?.google_verified===!0)return n}catch{}await new Promise(n=>setTimeout(n,e))}}async function Z(){try{const e=await d("/users/auth/google/"),t=e?.redirect_url||e?.redirect;if(!t){alert("구글 인증 시작 URL을 받지 못했습니다.");return}const o=K(t);let n;try{n=await X({})}finally{try{o&&!o.closed&&o.close()}catch{}}g&&(g.style.display=n?.google_verified?"block":"none"),I(!0),alert("구글 인증이 완료되었습니다.")}catch(e){console.error(e),alert(e.message||"구글 인증 중 오류")}}document.addEventListener("DOMContentLoaded",async()=>{await S(),await G()&&await T()});N?.addEventListener("click",z);x?.addEventListener("click",async()=>{try{const e=await d("/users/profile/preview/");sessionStorage.setItem("preview_profile",JSON.stringify(e)),location.href="pre.html"}catch{alert("미리보기를 불러올 수 없습니다.")}});M?.addEventListener("click",async()=>{try{await B(!0),location.href=q}catch(e){alert("저장 실패: "+(e.message||e))}});j?.addEventListener("click",e=>{e.preventDefault(),Z()});m?.addEventListener("click",()=>{p&&(p.style.display="none",m.style.display="none")});await F();const L=document.getElementById("btnLang");L?.addEventListener("click",async()=>{const e=await O();L.setAttribute("aria-label",e==="ko"?"언어 설정: 한국어":"Language: English")});
