import"./modulepreload-polyfill-B5Qt9EMX.js";import{s as C}from"./statusbar-time-3u5cukCV.js";import{i as O,t as $}from"./i18n-DcpoQoQT.js";const w=document.getElementById("name"),m=document.getElementById("email"),l=document.getElementById("pw"),f=document.getElementById("pw2"),T=document.getElementById("submitBtn"),b=document.getElementById("pw-hint-ok"),A=document.getElementById("pw2-hint-err"),R=/^(?=.*[~`!@#$%^&*()_\-+={}\[\]|\\:;"'<>,.?/]).{6,}$/;function p(e,t){const o=e.closest(".field");o.classList.remove("valid","invalid"),t==="valid"&&o.classList.add("valid"),t==="invalid"&&o.classList.add("invalid")}function v(){const e=w.value.trim().length>0,t=m.value.trim().length>0&&m.checkValidity(),o=R.test(l.value||""),n=l.value.length>0&&f.value===l.value;p(w,w.value?e?"valid":"invalid":null),p(m,m.value?t?"valid":"invalid":null),p(l,l.value?o?"valid":"invalid":null),p(f,f.value?n?"valid":"invalid":null),b.style.display=o&&l.value?"block":"none",A.style.display=!n&&f.value?"block":"none";const s=e&&t&&o&&n;T.disabled=!s}[w,m,l,f].forEach(e=>{e.addEventListener("input",v),e.addEventListener("blur",v)});v();C({hour12:!1,locale:"ko-KR"});const U="",_="/home/home.html";function x(e){const t=document.cookie.match(new RegExp("(^|; )"+e+"=([^;]*)"));return t?decodeURIComponent(t[2]):null}async function H(){x("csrftoken")||await fetch("/users/csrf/",{credentials:"include"})}async function E(e,t={}){const o=new Headers(t.headers||{});return o.has("Accept")||o.set("Accept","application/json"),fetch(`${U}${e}`,{...t,headers:o,credentials:"include"}).then(async n=>{const s=await n.text();let c;try{c=s?JSON.parse(s):null}catch{c={raw:s}}if(!n.ok){const a=c?.detail||JSON.stringify(c)||`HTTP ${n.status}`,r=new Error(a);throw r.status=n.status,r.payload=c,r}return c})}function P(e,t="google_oauth",o=520,n=700){const s=window.screenLeft!==void 0?window.screenLeft:screen.left,c=window.screenTop!==void 0?window.screenTop:screen.top,a=window.innerWidth||document.documentElement.clientWidth||screen.width,r=window.innerHeight||document.documentElement.clientHeight||screen.height,i=a/window.screen.availWidth,h=(a-o)/2/i+s,u=(r-n)/2/i+c,d=`scrollbars=yes, width=${o/i}, height=${n/i}, top=${u}, left=${h}`;return window.open(e,t,d)}async function D({intervalMs:e=1200,timeoutMs:t=12e4}={}){const o=Date.now();for(;;){if(Date.now()-o>t)throw new Error("구글 인증 시간이 초과되었습니다. 다시 시도해 주세요.");try{const n=await E("/users/profile/preview/");if(n?.google_verified===!0)return n}catch(n){if(n.status===401)throw new Error("로그인이 만료되었습니다. 다시 로그인해 주세요.")}await new Promise(n=>setTimeout(n,e))}}async function G({onDone:e}={}){try{await H();try{await E("/users/profile/")}catch(c){if(c.status===401){const a=location.pathname+location.search;location.href=`/login/login.html?next=${encodeURIComponent(a)}`;return}throw c}const o=(await E("/users/auth/google/"))?.redirect_url;if(!o){alert("구글 인증 시작 URL을 받지 못했습니다.");return}const n=P(o);let s;try{s=await D({})}finally{try{n&&!n.closed&&n.close()}catch{}}typeof e=="function"?e(s):location.replace(_)}catch(t){console.error(t),alert(t.message||"구글 인증 중 오류가 발생했습니다.")}}const I="",N="../profile/profile.html";function k(e){const t=document.cookie.match(new RegExp("(^|; )"+e+"=([^;]*)"));return t?decodeURIComponent(t[2]):null}function J(e){const t=document.querySelector('meta[name="csrf-token"]');t&&t.setAttribute("content",e||"")}async function B(){let e=k("csrftoken");return e||(await fetch(`${I}/users/csrf/`,{method:"GET",credentials:"include"}),e=k("csrftoken")),J(e),e}function F(e){return!["GET","HEAD","OPTIONS","TRACE"].includes(String(e).toUpperCase())}async function y(e,t={}){const o=(t.method||"GET").toUpperCase(),n=new Headers(t.headers||{});if(n.has("Accept")||n.set("Accept","application/json"),F(o)){const r=k("csrftoken")||await B();n.set("X-CSRFToken",r),!(t.body instanceof FormData)&&!n.has("Content-Type")&&n.set("Content-Type","application/json")}const s=await fetch(`${I}${e}`,{...t,method:o,headers:n,credentials:"include"}),c=await s.text();let a=null;try{a=c?JSON.parse(c):null}catch{a={raw:c}}if(!s.ok){const r=typeof a=="string"&&a||a?.detail||a&&JSON.stringify(a,null,2)||`HTTP ${s.status}`,i=new Error(r);throw i.status=s.status,i.payload=a,i}return a}async function j(){const t=await fetch(`${I}/users/auth/google/?next=${encodeURIComponent("/login/social-complete.html")}`,{method:"GET",credentials:"include",headers:{Accept:"application/json"}});let o={};try{o=await t.json()}catch{}o.redirect?location.href=o.redirect:t.redirected?location.href=t.url:alert("구글 인증 시작 URL을 받지 못했습니다.")}document.getElementById("googleLoginBtn")?.addEventListener("click",e=>{e.preventDefault(),j().catch(t=>{console.error(t),alert("구글 인증을 시작할 수 없습니다.")})});document.getElementById("googleConnectBtn")?.addEventListener("click",e=>{e.preventDefault(),G({onDone:t=>{const o=document.querySelector(".badge-img");o&&(o.style.display=t?.google_verified?"block":"none"),alert("구글 인증이 완료되었습니다.")}})});document.addEventListener("DOMContentLoaded",async()=>{await B();const e=document.querySelector(".form"),t=document.getElementById("name"),o=document.getElementById("nation"),n=document.getElementById("email"),s=document.getElementById("pw"),c=document.getElementById("pw2");e?.addEventListener("submit",async a=>{a.preventDefault();const r=t?.value.trim(),h=o?.value==="kr"?"korean":"foreigner",u=n?.value.trim(),d=s?.value,g=c?.value;if(!r||!u||!d||!g){alert("모든 필드를 입력해 주세요.");return}if(d!==g){alert("비밀번호가 일치하지 않습니다.");return}try{await y("/users/signup/",{method:"POST",body:JSON.stringify({username:u,real_name:r,user_type:h,password1:d,password2:g})}),await y("/users/login/",{method:"POST",body:JSON.stringify({username:u,password:d})}),await y("/users/profile/"),window.location.replace(N)}catch(S){console.error(S),alert(`회원가입/로그인 실패:
${S.message}`)}})});await O();const L=document.querySelector(".top-right-icon");L?.addEventListener("click",async()=>{const e=await $();L.setAttribute("aria-label",e==="ko"?"언어 설정: 한국어":"Language: English")});
